<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Service - Complete Documentation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }

        h1 { color: #2c3e50; border-bottom: 3px solid #e74c3c; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; border-bottom: 2px solid #ecf0f1; padding-bottom: 5px; }
        h3 { color: #c0392b; margin-top: 25px; }
        h4 { color: #e67e22; margin-top: 20px; }

        code {
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
            font-size: 0.9em;
        }

        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
        }

        pre code {
            background: none;
            padding: 0;
            color: #333;
        }

        .info-box {
            background-color: #fff5f5;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }

        .success-box {
            background-color: #f0fff4;
            border-left-color: #27ae60;
        }

        .warning-box {
            background-color: #fffbf0;
            border-left-color: #f39c12;
        }

        .ai-box {
            background-color: #f5f3ff;
            border-left-color: #8b5cf6;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .feature-card h4 {
            margin-top: 0;
            color: white;
        }

        .model-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }

        .model-card h4 {
            color: #c0392b;
            margin-top: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .file-tree {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-line;
            font-size: 0.9em;
        }

        .method-signature {
            background-color: #fdf2e9;
            border: 1px solid #f39c12;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }

        .pipeline-step {
            background: linear-gradient(90deg, #ff7675, #fd79a8);
            color: white;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
        }

        .emoji { font-size: 1.2em; }

        ul, ol { margin: 10px 0; }
        li { margin: 5px 0; }

        .toc {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }

        .toc li {
            margin: 5px 0;
        }

        .toc a {
            color: #c0392b;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .performance-metric {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        @media print {
            body { margin: 0; padding: 15px; }
            .no-print { display: none; }
            .feature-card { background: #f8f9fa !important; color: #333 !important; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <h1><span class="emoji">ü§ñ</span> AI Service - Complete Documentation</h1>

    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#architecture">Architecture</a></li>
            <li><a href="#model-management">Model Management</a></li>
            <li><a href="#document-processing">Document Processing</a></li>
            <li><a href="#resume-analysis">Resume Analysis</a></li>
            <li><a href="#voice-analysis">Voice Analysis</a></li>
            <li><a href="#job-matching">Job Matching</a></li>
            <li><a href="#api-usage">API Usage Examples</a></li>
            <li><a href="#performance">Performance Optimization</a></li>
            <li><a href="#integration">Integration</a></li>
        </ul>
    </div>

    <h2 id="overview"><span class="emoji">üìã</span> Overview</h2>

    <p>The AI Service is the core intelligence component of the AI Resume Server, providing advanced machine learning capabilities for resume analysis, voice processing, and job matching. It integrates multiple AI models and leverages the Dataset Manager for industry-specific intelligence.</p>

    <h2 id="architecture"><span class="emoji">üèóÔ∏è</span> Architecture</h2>

    <h3>Core Components</h3>

    <div class="file-tree">AIService
‚îú‚îÄ‚îÄ Document Processing
‚îÇ   ‚îú‚îÄ‚îÄ PDF Text Extraction
‚îÇ   ‚îú‚îÄ‚îÄ DOCX Processing
‚îÇ   ‚îî‚îÄ‚îÄ Plain Text Handling
‚îú‚îÄ‚îÄ Resume Analysis
‚îÇ   ‚îú‚îÄ‚îÄ Contact Information Extraction
‚îÇ   ‚îú‚îÄ‚îÄ Skills Detection
‚îÇ   ‚îú‚îÄ‚îÄ Experience Analysis
‚îÇ   ‚îú‚îÄ‚îÄ Education Parsing
‚îÇ   ‚îú‚îÄ‚îÄ Certifications Identification
‚îÇ   ‚îî‚îÄ‚îÄ Industry Detection
‚îú‚îÄ‚îÄ Voice Analysis
‚îÇ   ‚îú‚îÄ‚îÄ Audio Transcription (Whisper)
‚îÇ   ‚îú‚îÄ‚îÄ Speech Feature Extraction
‚îÇ   ‚îú‚îÄ‚îÄ Communication Assessment
‚îÇ   ‚îî‚îÄ‚îÄ Language Quality Analysis
‚îú‚îÄ‚îÄ Job Matching
‚îÇ   ‚îú‚îÄ‚îÄ Skills Matching
‚îÇ   ‚îú‚îÄ‚îÄ Experience Scoring
‚îÇ   ‚îú‚îÄ‚îÄ Education Assessment
‚îÇ   ‚îî‚îÄ‚îÄ Overall Compatibility Rating
‚îî‚îÄ‚îÄ Model Management
    ‚îú‚îÄ‚îÄ Lazy Loading
    ‚îú‚îÄ‚îÄ Memory Optimization
    ‚îî‚îÄ‚îÄ Error Handling</div>

    <h3>Dependencies</h3>

    <div class="feature-grid">
        <div class="feature-card">
            <h4><span class="emoji">üß†</span> Core ML Libraries</h4>
            <ul>
                <li>OpenAI Whisper - Speech-to-text</li>
                <li>Transformers - NLP models</li>
                <li>Sentence-Transformers - Embeddings</li>
                <li>spaCy - Named entity recognition</li>
                <li>scikit-learn - ML algorithms</li>
                <li>TextBlob - Sentiment analysis</li>
            </ul>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üéµ</span> Audio Processing</h4>
            <ul>
                <li>librosa - Audio feature extraction</li>
                <li>soundfile - Audio file handling</li>
                <li>pydub - Audio format conversion</li>
            </ul>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üìÑ</span> Document Processing</h4>
            <ul>
                <li>PyPDF2 - PDF text extraction</li>
                <li>pdfplumber - Enhanced PDF processing</li>
                <li>python-docx - Word documents</li>
            </ul>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üî¢</span> Scientific Computing</h4>
            <ul>
                <li>numpy - Numerical computations</li>
                <li>pandas - Data manipulation</li>
            </ul>
        </div>
    </div>

    <h2 id="model-management"><span class="emoji">‚öôÔ∏è</span> Model Management</h2>

    <h3>Lazy Loading System</h3>

    <div class="ai-box">
        <p>The AI Service implements lazy loading for optimal performance and memory usage. Models are only loaded when first accessed, reducing startup time and memory footprint.</p>
    </div>

    <pre><code>class AIService:
    def __init__(self, dataset_path: str = "datasets/"):
        self._whisper_model = None
        self._sentence_model = None
        self._nlp_model = None
        self.dataset_manager = DatasetManager(dataset_path)

    @property
    def whisper_model(self):
        """Lazy load Whisper model."""
        if self._whisper_model is None:
            self._whisper_model = whisper.load_model(settings.whisper_model)
        return self._whisper_model</code></pre>

    <h3>Model Specifications</h3>

    <div class="model-card">
        <h4><span class="emoji">üéôÔ∏è</span> Whisper Model</h4>
        <ul>
            <li><strong>Purpose:</strong> Audio transcription</li>
            <li><strong>Model Size:</strong> Configurable (tiny, base, small, medium, large)</li>
            <li><strong>Languages:</strong> 100+ languages supported</li>
            <li><strong>Memory Usage:</strong> 1-10GB depending on model size</li>
            <li><strong>Load Time:</strong> 5-30 seconds</li>
        </ul>
    </div>

    <div class="model-card">
        <h4><span class="emoji">üî§</span> Sentence Transformer</h4>
        <ul>
            <li><strong>Model:</strong> all-MiniLM-L6-v2</li>
            <li><strong>Purpose:</strong> Text embeddings for similarity</li>
            <li><strong>Memory Usage:</strong> ~400MB</li>
            <li><strong>Load Time:</strong> 2-5 seconds</li>
        </ul>
    </div>

    <div class="model-card">
        <h4><span class="emoji">üè∑Ô∏è</span> spaCy Model</h4>
        <ul>
            <li><strong>Model:</strong> en_core_web_sm</li>
            <li><strong>Purpose:</strong> Named entity recognition</li>
            <li><strong>Memory Usage:</strong> ~50MB</li>
            <li><strong>Load Time:</strong> 1-3 seconds</li>
        </ul>
    </div>

    <h2 id="document-processing"><span class="emoji">üìÑ</span> Document Processing</h2>

    <h3>Supported Formats</h3>

    <div class="info-box">
        <h4>PDF Files</h4>
        <p>Dual extraction strategy with pdfplumber as primary and PyPDF2 as fallback for maximum compatibility.</p>
        <pre><code>def _extract_from_pdf(self, file_path: str) -> str:
    """Extract text from PDF file."""
    text = ""
    try:
        # Primary: pdfplumber (better formatting)
        with pdfplumber.open(file_path) as pdf:
            for page in pdf.pages:
                page_text = page.extract_text()
                if page_text:
                    text += page_text + "\n"
    except:
        # Fallback: PyPDF2
        with open(file_path, "rb") as file:
            reader = PyPDF2.PdfReader(file)
            for page in reader.pages:
                text += page.extract_text() + "\n"
    return text.strip()</code></pre>
    </div>

    <div class="info-box">
        <h4>DOCX Files</h4>
        <p>Direct paragraph extraction maintaining document structure.</p>
        <pre><code>def _extract_from_docx(self, file_path: str) -> str:
    """Extract text from DOCX file."""
    doc = Document(file_path)
    text = ""
    for paragraph in doc.paragraphs:
        text += paragraph.text + "\n"
    return text.strip()</code></pre>
    </div>

    <h3>Usage</h3>
    <pre><code>from app.services import ai_service

# Extract text from any supported format
text = ai_service.extract_text_from_file(
    file_path="/path/to/resume.pdf",
    mime_type="application/pdf"
)</code></pre>

    <h2 id="resume-analysis"><span class="emoji">üìä</span> Resume Analysis</h2>

    <h3>Complete Analysis Pipeline</h3>

    <div class="pipeline-step">Industry Detection</div>
    <div class="pipeline-step">Contact Extraction</div>
    <div class="pipeline-step">Skills Analysis</div>
    <div class="pipeline-step">Experience Parsing</div>
    <div class="pipeline-step">Education Detection</div>
    <div class="pipeline-step">Certification Identification</div>
    <div class="pipeline-step">Summary Generation</div>

    <pre><code>def analyze_resume(self, text: str, target_industry: Optional[str] = None) -> Dict:
    """Enhanced resume analysis with industry detection and manual datasets."""
    doc = self.nlp_model(text)

    # Detect industry if not provided
    if not target_industry:
        target_industry = self.dataset_manager.detect_industry(text)

    analysis = {
        "detected_industry": target_industry,
        "contact_info": self._extract_contact_info(text, doc),
        "skills": self._extract_skills_enhanced(text, target_industry),
        "experience": self._extract_experience_enhanced(text, doc),
        "education": self._extract_education_enhanced(text, doc),
        "certifications": self._extract_certifications_enhanced(text),
        "languages": self._extract_languages(text),
        "professional_summary": self._generate_professional_summary(text),
        "experience_level": self._determine_experience_level(text),
        "total_experience_years": self._calculate_experience_years(text),
        "job_titles": self._extract_job_titles(text),
        "achievements": self._extract_achievements(text),
        "soft_skills": self._extract_soft_skills(text),
    }

    return analysis</code></pre>

    <h3>Contact Information Extraction</h3>

    <div class="ai-box">
        <h4>Features Detected</h4>
        <ul>
            <li><strong>Email:</strong> Multiple pattern matching with validation</li>
            <li><strong>Phone:</strong> International and domestic formats</li>
            <li><strong>Name:</strong> NER + heuristic extraction from document header</li>
            <li><strong>Location:</strong> Geographic entities via spaCy</li>
            <li><strong>LinkedIn:</strong> URL pattern matching and validation</li>
        </ul>
    </div>

    <h3>Skills Extraction Algorithm</h3>

    <div class="info-box">
        <h4>Enhanced Multi-Step Process</h4>
        <ol>
            <li><strong>Industry Detection:</strong> Automatically detect resume industry</li>
            <li><strong>Industry-Specific Matching:</strong> Prioritize relevant skills</li>
            <li><strong>Category Organization:</strong> Group skills by functional type</li>
            <li><strong>Comprehensive Coverage:</strong> Include skills from all industries</li>
            <li><strong>Deduplication:</strong> Remove duplicate skills across categories</li>
        </ol>
    </div>

    <h3>Experience Level Determination</h3>

    <pre><code>def _determine_experience_level(self, text: str) -> str:
    text_lower = text.lower()

    # Senior level indicators
    senior_indicators = [
        "senior", "lead", "principal", "director", "manager",
        "10+ years", "expert", "architect", "executive"
    ]

    # Calculate weighted score based on indicators and years
    years = self._calculate_experience_years(text)

    if senior_count >= 2 or years >= 10:
        return "senior"
    elif mid_count >= 1 or years >= 5:
        return "mid"
    elif junior_count >= 1 or years <= 2:
        return "junior"
    else:
        return "mid"  # Default to mid-level</code></pre>

    <h2 id="voice-analysis"><span class="emoji">üéôÔ∏è</span> Voice Analysis</h2>

    <h3>Audio Transcription</h3>

    <div class="performance-metric">
        Whisper Model Accuracy: 95%+ for English
    </div>

    <pre><code>def transcribe_audio(self, file_path: str) -> Tuple[str, float]:
    """Transcribe audio file to text."""
    try:
        result = self.whisper_model.transcribe(file_path)
        transcript = result["text"]
        confidence = self._estimate_transcript_confidence(transcript)
        return transcript, confidence
    except Exception as e:
        raise Exception(f"Audio transcription failed: {str(e)}")</code></pre>

    <h3>Speech Feature Extraction</h3>

    <div class="ai-box">
        <h4>Technical Features Analyzed</h4>
        <ul>
            <li><strong>Duration:</strong> Total speaking time</li>
            <li><strong>Speaking Rate:</strong> Words per minute calculation</li>
            <li><strong>Pitch Analysis:</strong> Mean fundamental frequency</li>
            <li><strong>Energy Levels:</strong> RMS energy analysis</li>
            <li><strong>Spectral Features:</strong> Voice quality indicators</li>
            <li><strong>Rhythm Patterns:</strong> Zero crossing rate analysis</li>
        </ul>
    </div>

    <h3>Communication Scoring</h3>

    <div class="feature-grid">
        <div class="feature-card">
            <h4><span class="emoji">üîä</span> Clarity Score</h4>
            <p>Based on energy consistency and pitch stability. Optimal range detection for professional communication.</p>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üí™</span> Confidence Score</h4>
            <p>Sentiment analysis combined with professional language usage and industry terminology.</p>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üó£Ô∏è</span> Fluency Score</h4>
            <p>Sentence structure analysis with filler word detection and speech flow assessment.</p>
        </div>
        <div class="feature-card">
            <h4><span class="emoji">üìö</span> Vocabulary Score</h4>
            <p>Language diversity, complexity analysis, and technical vocabulary usage.</p>
        </div>
    </div>

    <h2 id="job-matching"><span class="emoji">üéØ</span> Job Matching</h2>

    <h3>Enhanced Matching Algorithm</h3>

    <div class="info-box">
        <h4>Multi-Dimensional Scoring</h4>
        <ul>
            <li><strong>Skills Matching:</strong> Required vs preferred skills with industry bonus</li>
            <li><strong>Experience Assessment:</strong> Years + role relevance scoring</li>
            <li><strong>Education Alignment:</strong> Degree level and field matching</li>
            <li><strong>Certification Validation:</strong> Professional credentials verification</li>
            <li><strong>Industry Fit:</strong> Cross-industry compatibility scoring</li>
        </ul>
    </div>

    <h3>Skills Matching with Industry Bonus</h3>

    <pre><code>def _calculate_skills_match_enhanced(self, resume_skills: List[str],
                                   required_skills: List[str],
                                   preferred_skills: List[str],
                                   industry: str) -> int:
    # Calculate basic matches
    required_matches = sum(1 for skill in required_skills if skill.lower() in resume_skills)
    preferred_matches = sum(1 for skill in preferred_skills if skill.lower() in resume_skills)

    # Industry bonus for relevant skills
    industry_skills = self.dataset_manager.get_skills_by_industry(industry)
    industry_matches = sum(1 for skill in resume_skills
                          if skill in [s.lower() for s in industry_skills])
    industry_bonus = min(10, industry_matches * 2)  # Up to 10 bonus points

    base_score = required_score * 0.8 + preferred_score * 0.2 if required_skills else preferred_score
    return int(min(100, base_score + industry_bonus))</code></pre>

    <h2 id="api-usage"><span class="emoji">üíª</span> API Usage Examples</h2>

    <h3>Basic Resume Analysis</h3>

    <pre><code>from app.services import ai_service

# Extract and analyze resume
resume_text = ai_service.extract_text_from_file(
    file_path="/path/to/resume.pdf",
    mime_type="application/pdf"
)

analysis = ai_service.analyze_resume(resume_text)

print(f"Detected Industry: {analysis['detected_industry']}")
print(f"Experience Level: {analysis['experience_level']}")
print(f"Total Experience: {analysis['total_experience_years']} years")
print(f"Skills Found: {len(analysis['skills'])}")</code></pre>

    <h3>Voice Analysis</h3>

    <pre><code># Transcribe and analyze voice recording
transcript, confidence = ai_service.transcribe_audio("/path/to/audio.wav")
print(f"Transcription Confidence: {confidence:.2f}")

voice_analysis = ai_service.analyze_voice("/path/to/audio.wav", transcript)
print(f"Communication Score: {voice_analysis['overall_communication_score']}")
print(f"Strengths: {voice_analysis['strengths']}")</code></pre>

    <h3>Job Matching</h3>

    <pre><code># Define job requirements
job_requirements = {
    "industry": "technology",
    "required_skills": ["python", "aws", "docker"],
    "preferred_skills": ["kubernetes", "terraform", "react"],
    "required_experience": {
        "min_years": 5,
        "preferred_roles": ["software engineer", "devops engineer"]
    },
    "matching_weights": {
        "skills": 0.4,
        "experience": 0.3,
        "education": 0.2,
        "certifications": 0.1
    }
}

# Match resume to job
match_result = ai_service.match_resume_to_job(resume_analysis, job_requirements)
print(f"Overall Match Score: {match_result['overall_score']}%")
print(f"Matching Skills: {match_result['match_details']['matching_skills']}")
print(f"Missing Skills: {match_result['match_details']['missing_skills']}")</code></pre>

    <h2 id="performance"><span class="emoji">‚ö°</span> Performance Optimization</h2>

    <h3>Memory Management</h3>

    <div class="warning-box">
        <h4>Model Cleanup for Long-Running Processes</h4>
        <pre><code>def cleanup_models(self):
    """Free model memory when not in use."""
    if hasattr(self, '_whisper_model') and self._whisper_model:
        del self._whisper_model
        self._whisper_model = None

    # Force garbage collection
    import gc
    gc.collect()</code></pre>
    </div>

    <h3>Performance Metrics</h3>

    <div class="performance-metric">
        Document Processing: ~2-10s per resume
    </div>
    <div class="performance-metric">
        Voice Analysis: ~30s per minute of audio
    </div>
    <div class="performance-metric">
        Job Matching: <1s per comparison
    </div>

    <h3>Caching Strategy</h3>

    <pre><code>from functools import lru_cache

@lru_cache(maxsize=100)
def _cached_industry_detection(self, text_hash: str) -> str:
    """Cache industry detection results."""
    return self.dataset_manager.detect_industry(text)

def detect_industry_cached(self, text: str) -> str:
    """Industry detection with caching."""
    text_hash = hash(text[:1000])  # Hash first 1000 chars
    return self._cached_industry_detection(text_hash)</code></pre>

    <h2 id="integration"><span class="emoji">üîó</span> Integration with FastAPI</h2>

    <h3>Service Endpoints</h3>

    <pre><code>from fastapi import FastAPI, UploadFile, HTTPException
from app.services import ai_service, AI_SERVICE_AVAILABLE

@app.post("/api/analyze-resume")
async def analyze_resume_endpoint(file: UploadFile):
    if not AI_SERVICE_AVAILABLE:
        raise HTTPException(status_code=503, detail="AI service unavailable")

    try:
        # Save uploaded file temporarily
        temp_path = f"/tmp/{file.filename}"
        with open(temp_path, "wb") as f:
            content = await file.read()
            f.write(content)

        # Extract and analyze
        text = ai_service.extract_text_from_file(temp_path, file.content_type)
        analysis = ai_service.analyze_resume(text)

        # Cleanup
        os.unlink(temp_path)

        return analysis
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))</code></pre>

    <div class="success-box">
        <h3><span class="emoji">üéØ</span> Summary</h3>
        <p>The AI Service provides comprehensive machine learning capabilities for resume analysis, voice processing, and intelligent job matching. With lazy model loading, robust error handling, and performance optimization, it delivers powerful AI functionality while maintaining system efficiency and reliability.</p>
    </div>

    <div class="no-print" style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
        <h3><span class="emoji">üí°</span> Convert to PDF</h3>
        <p>To convert this documentation to PDF:</p>
        <ol>
            <li>Open this HTML file in your web browser</li>
            <li>Press <kbd>Ctrl+P</kbd> (or <kbd>Cmd+P</kbd> on Mac)</li>
            <li>Select "Save as PDF" as the destination</li>
            <li>Adjust print settings if needed</li>
            <li>Click "Save"</li>
        </ol>
    </div>
</body>
</html>